<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetris Game Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #2c3e50;
            color: white;
            padding: 20px;
            margin: 0;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .success { border-left-color: #27ae60; }
        .error { border-left-color: #e74c3c; }
        .warning { border-left-color: #f39c12; }
        
        button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            transform: translateY(-2px);
        }
        
        #gameFrame {
            width: 100%;
            height: 600px;
            border: 2px solid #3498db;
            border-radius: 8px;
            background: white;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🎮 Modern Tetris - 게임 테스트</h1>
        
        <div class="test-item">
            <h3>🔧 시스템 요구사항 검사</h3>
            <div id="systemCheck">검사 중...</div>
        </div>
        
        <div class="test-item">
            <h3>📱 브라우저 기능 지원</h3>
            <div id="browserCheck">검사 중...</div>
        </div>
        
        <div class="test-item">
            <h3>🎵 오디오 시스템</h3>
            <div id="audioCheck">검사 중...</div>
            <button onclick="testAudio()">오디오 테스트</button>
        </div>
        
        <div class="test-item">
            <h3>🕹️ 게임 실행</h3>
            <button onclick="loadGame()">게임 로드</button>
            <button onclick="testControls()">조작 테스트</button>
        </div>
        
        <iframe id="gameFrame" src="about:blank" style="display:none;"></iframe>
        
        <div class="test-item">
            <h3>📊 성능 정보</h3>
            <div id="performanceInfo"></div>
        </div>
        
        <div class="test-item">
            <h3>🐛 로그 출력</h3>
            <div id="logs" style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        // 로그 캡처
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addLog(type, ...args) {
            const logDiv = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const message = args.join(' ');
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\\n`;
            logDiv.textContent += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = (...args) => {
            originalLog(...args);
            addLog('log', ...args);
        };
        
        console.error = (...args) => {
            originalError(...args);
            addLog('error', ...args);
        };
        
        console.warn = (...args) => {
            originalWarn(...args);
            addLog('warn', ...args);
        };
        
        // 시스템 검사
        function checkSystem() {
            const checks = [
                {
                    name: 'ES6 Modules',
                    test: () => typeof import === 'function',
                    required: true
                },
                {
                    name: 'Canvas 2D',
                    test: () => {
                        const canvas = document.createElement('canvas');
                        return !!(canvas.getContext && canvas.getContext('2d'));
                    },
                    required: true
                },
                {
                    name: 'LocalStorage',
                    test: () => typeof Storage !== 'undefined',
                    required: true
                },
                {
                    name: 'WebSocket',
                    test: () => typeof WebSocket !== 'undefined',
                    required: false
                },
                {
                    name: 'Web Audio API',
                    test: () => typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined',
                    required: false
                },
                {
                    name: 'Request Animation Frame',
                    test: () => typeof requestAnimationFrame !== 'undefined',
                    required: true
                },
                {
                    name: 'JSON',
                    test: () => typeof JSON !== 'undefined',
                    required: true
                }
            ];
            
            const systemDiv = document.getElementById('systemCheck');
            let html = '';
            let allRequired = true;
            
            checks.forEach(check => {
                const result = check.test();
                const status = result ? '✅' : '❌';
                const color = result ? '#27ae60' : '#e74c3c';
                
                if (check.required && !result) {
                    allRequired = false;
                }
                
                html += \`<div style="color: \${color};">\${status} \${check.name} \${check.required ? '(필수)' : '(선택)'}</div>\`;
            });
            
            systemDiv.innerHTML = html;
            systemDiv.parentElement.className = allRequired ? 'test-item success' : 'test-item error';
            
            return allRequired;
        }
        
        // 브라우저 검사
        function checkBrowser() {
            const browserDiv = document.getElementById('browserCheck');
            const userAgent = navigator.userAgent;
            const platform = navigator.platform;
            
            let browserName = 'Unknown';
            let browserVersion = 'Unknown';
            
            if (userAgent.indexOf('Chrome') > -1) {
                browserName = 'Chrome';
                browserVersion = userAgent.match(/Chrome\\/([0-9.]+)/)[1];
            } else if (userAgent.indexOf('Firefox') > -1) {
                browserName = 'Firefox';
                browserVersion = userAgent.match(/Firefox\\/([0-9.]+)/)[1];
            } else if (userAgent.indexOf('Safari') > -1 && userAgent.indexOf('Chrome') === -1) {
                browserName = 'Safari';
                browserVersion = userAgent.match(/Safari\\/([0-9.]+)/)[1];
            } else if (userAgent.indexOf('Edge') > -1) {
                browserName = 'Edge';
                browserVersion = userAgent.match(/Edge\\/([0-9.]+)/)[1];
            }
            
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            const screenInfo = \`\${screen.width}x\${screen.height}\`;
            
            browserDiv.innerHTML = \`
                <div>🌐 브라우저: \${browserName} \${browserVersion}</div>
                <div>💻 플랫폼: \${platform}</div>
                <div>📱 모바일: \${isMobile ? '예' : '아니오'}</div>
                <div>🖥️ 화면 해상도: \${screenInfo}</div>
                <div>🎨 색상 깊이: \${screen.colorDepth}bit</div>
            \`;
            
            browserDiv.parentElement.className = 'test-item success';
        }
        
        // 오디오 검사
        function checkAudio() {
            const audioDiv = document.getElementById('audioCheck');
            
            try {
                const AudioContextClass = window.AudioContext || window.webkitAudioContext;
                if (AudioContextClass) {
                    const audioContext = new AudioContextClass();
                    audioDiv.innerHTML = \`
                        <div>✅ Web Audio API 지원</div>
                        <div>🎵 샘플레이트: \${audioContext.sampleRate}Hz</div>
                        <div>🔊 상태: \${audioContext.state}</div>
                    \`;
                    audioContext.close();
                    audioDiv.parentElement.className = 'test-item success';
                } else {
                    throw new Error('Web Audio API not supported');
                }
            } catch (error) {
                audioDiv.innerHTML = \`<div style="color: #e74c3c;">❌ 오디오 시스템 오류: \${error.message}</div>\`;
                audioDiv.parentElement.className = 'test-item warning';
            }
        }
        
        // 성능 정보
        function showPerformanceInfo() {
            const perfDiv = document.getElementById('performanceInfo');
            
            const memInfo = performance.memory ? {
                used: Math.round(performance.memory.usedJSHeapSize / 1048576),
                total: Math.round(performance.memory.totalJSHeapSize / 1048576),
                limit: Math.round(performance.memory.jsHeapSizeLimit / 1048576)
            } : null;
            
            let html = \`
                <div>⏱️ 페이지 로드 시간: \${Math.round(performance.now())}ms</div>
                <div>🏃 사용자 에이전트: \${navigator.userAgent.substring(0, 50)}...</div>
                <div>🧭 온라인 상태: \${navigator.onLine ? '온라인' : '오프라인'}</div>
                <div>🌐 언어: \${navigator.language}</div>
            \`;
            
            if (memInfo) {
                html += \`
                    <div>💾 메모리 사용: \${memInfo.used}MB / \${memInfo.total}MB (한계: \${memInfo.limit}MB)</div>
                \`;
            }
            
            perfDiv.innerHTML = html;
        }
        
        // 오디오 테스트
        function testAudio() {
            try {
                const AudioContextClass = window.AudioContext || window.webkitAudioContext;
                const audioContext = new AudioContextClass();
                
                // 간단한 비프음 생성
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 440; // A4 음
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
                
                console.log('🔊 오디오 테스트 음 재생');
                
                setTimeout(() => {
                    audioContext.close();
                }, 1000);
                
            } catch (error) {
                console.error('오디오 테스트 실패:', error);
            }
        }
        
        // 게임 로드
        function loadGame() {
            const frame = document.getElementById('gameFrame');
            frame.style.display = 'block';
            frame.src = 'index.html';
            console.log('🎮 게임 프레임 로드');
        }
        
        // 조작 테스트
        function testControls() {
            console.log('🕹️ 키보드 이벤트 리스너 테스트 시작');
            
            const testKeys = ['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Space'];
            let testResults = {};
            
            const keyHandler = (e) => {
                if (testKeys.includes(e.code)) {
                    testResults[e.code] = true;
                    console.log(\`✅ 키 감지: \${e.code}\`);
                    
                    // 모든 키가 테스트되면 리스너 제거
                    if (Object.keys(testResults).length === testKeys.length) {
                        document.removeEventListener('keydown', keyHandler);
                        console.log('🎯 모든 테스트 키 감지 완료!');
                    }
                }
            };
            
            document.addEventListener('keydown', keyHandler);
            
            setTimeout(() => {
                document.removeEventListener('keydown', keyHandler);
                console.log('⏰ 조작 테스트 시간 종료');
            }, 10000);
            
            alert('10초 동안 화살표 키와 스페이스바를 눌러보세요!');
        }
        
        // 초기화
        function init() {
            console.log('🚀 테트리스 게임 시스템 검사 시작');
            
            checkSystem();
            checkBrowser();
            checkAudio();
            showPerformanceInfo();
            
            console.log('✅ 시스템 검사 완료');
        }
        
        // 페이지 로드 시 실행
        window.addEventListener('load', init);
        
        // 에러 캐치
        window.addEventListener('error', (e) => {
            console.error('전역 오류:', e.error);
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            console.error('처리되지 않은 Promise 거부:', e.reason);
        });
    </script>
</body>
</html>