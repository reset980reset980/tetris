<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetris Game Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #2c3e50;
            color: white;
            padding: 20px;
            margin: 0;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .success { border-left-color: #27ae60; }
        .error { border-left-color: #e74c3c; }
        .warning { border-left-color: #f39c12; }
        
        button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            transform: translateY(-2px);
        }
        
        #gameFrame {
            width: 100%;
            height: 600px;
            border: 2px solid #3498db;
            border-radius: 8px;
            background: white;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ® Modern Tetris - ê²Œì„ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-item">
            <h3>ğŸ”§ ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ ê²€ì‚¬</h3>
            <div id="systemCheck">ê²€ì‚¬ ì¤‘...</div>
        </div>
        
        <div class="test-item">
            <h3>ğŸ“± ë¸Œë¼ìš°ì € ê¸°ëŠ¥ ì§€ì›</h3>
            <div id="browserCheck">ê²€ì‚¬ ì¤‘...</div>
        </div>
        
        <div class="test-item">
            <h3>ğŸµ ì˜¤ë””ì˜¤ ì‹œìŠ¤í…œ</h3>
            <div id="audioCheck">ê²€ì‚¬ ì¤‘...</div>
            <button onclick="testAudio()">ì˜¤ë””ì˜¤ í…ŒìŠ¤íŠ¸</button>
        </div>
        
        <div class="test-item">
            <h3>ğŸ•¹ï¸ ê²Œì„ ì‹¤í–‰</h3>
            <button onclick="loadGame()">ê²Œì„ ë¡œë“œ</button>
            <button onclick="testControls()">ì¡°ì‘ í…ŒìŠ¤íŠ¸</button>
        </div>
        
        <iframe id="gameFrame" src="about:blank" style="display:none;"></iframe>
        
        <div class="test-item">
            <h3>ğŸ“Š ì„±ëŠ¥ ì •ë³´</h3>
            <div id="performanceInfo"></div>
        </div>
        
        <div class="test-item">
            <h3>ğŸ› ë¡œê·¸ ì¶œë ¥</h3>
            <div id="logs" style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        // ë¡œê·¸ ìº¡ì²˜
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addLog(type, ...args) {
            const logDiv = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const message = args.join(' ');
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\\n`;
            logDiv.textContent += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = (...args) => {
            originalLog(...args);
            addLog('log', ...args);
        };
        
        console.error = (...args) => {
            originalError(...args);
            addLog('error', ...args);
        };
        
        console.warn = (...args) => {
            originalWarn(...args);
            addLog('warn', ...args);
        };
        
        // ì‹œìŠ¤í…œ ê²€ì‚¬
        function checkSystem() {
            const checks = [
                {
                    name: 'ES6 Modules',
                    test: () => typeof import === 'function',
                    required: true
                },
                {
                    name: 'Canvas 2D',
                    test: () => {
                        const canvas = document.createElement('canvas');
                        return !!(canvas.getContext && canvas.getContext('2d'));
                    },
                    required: true
                },
                {
                    name: 'LocalStorage',
                    test: () => typeof Storage !== 'undefined',
                    required: true
                },
                {
                    name: 'WebSocket',
                    test: () => typeof WebSocket !== 'undefined',
                    required: false
                },
                {
                    name: 'Web Audio API',
                    test: () => typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined',
                    required: false
                },
                {
                    name: 'Request Animation Frame',
                    test: () => typeof requestAnimationFrame !== 'undefined',
                    required: true
                },
                {
                    name: 'JSON',
                    test: () => typeof JSON !== 'undefined',
                    required: true
                }
            ];
            
            const systemDiv = document.getElementById('systemCheck');
            let html = '';
            let allRequired = true;
            
            checks.forEach(check => {
                const result = check.test();
                const status = result ? 'âœ…' : 'âŒ';
                const color = result ? '#27ae60' : '#e74c3c';
                
                if (check.required && !result) {
                    allRequired = false;
                }
                
                html += \`<div style="color: \${color};">\${status} \${check.name} \${check.required ? '(í•„ìˆ˜)' : '(ì„ íƒ)'}</div>\`;
            });
            
            systemDiv.innerHTML = html;
            systemDiv.parentElement.className = allRequired ? 'test-item success' : 'test-item error';
            
            return allRequired;
        }
        
        // ë¸Œë¼ìš°ì € ê²€ì‚¬
        function checkBrowser() {
            const browserDiv = document.getElementById('browserCheck');
            const userAgent = navigator.userAgent;
            const platform = navigator.platform;
            
            let browserName = 'Unknown';
            let browserVersion = 'Unknown';
            
            if (userAgent.indexOf('Chrome') > -1) {
                browserName = 'Chrome';
                browserVersion = userAgent.match(/Chrome\\/([0-9.]+)/)[1];
            } else if (userAgent.indexOf('Firefox') > -1) {
                browserName = 'Firefox';
                browserVersion = userAgent.match(/Firefox\\/([0-9.]+)/)[1];
            } else if (userAgent.indexOf('Safari') > -1 && userAgent.indexOf('Chrome') === -1) {
                browserName = 'Safari';
                browserVersion = userAgent.match(/Safari\\/([0-9.]+)/)[1];
            } else if (userAgent.indexOf('Edge') > -1) {
                browserName = 'Edge';
                browserVersion = userAgent.match(/Edge\\/([0-9.]+)/)[1];
            }
            
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            const screenInfo = \`\${screen.width}x\${screen.height}\`;
            
            browserDiv.innerHTML = \`
                <div>ğŸŒ ë¸Œë¼ìš°ì €: \${browserName} \${browserVersion}</div>
                <div>ğŸ’» í”Œë«í¼: \${platform}</div>
                <div>ğŸ“± ëª¨ë°”ì¼: \${isMobile ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}</div>
                <div>ğŸ–¥ï¸ í™”ë©´ í•´ìƒë„: \${screenInfo}</div>
                <div>ğŸ¨ ìƒ‰ìƒ ê¹Šì´: \${screen.colorDepth}bit</div>
            \`;
            
            browserDiv.parentElement.className = 'test-item success';
        }
        
        // ì˜¤ë””ì˜¤ ê²€ì‚¬
        function checkAudio() {
            const audioDiv = document.getElementById('audioCheck');
            
            try {
                const AudioContextClass = window.AudioContext || window.webkitAudioContext;
                if (AudioContextClass) {
                    const audioContext = new AudioContextClass();
                    audioDiv.innerHTML = \`
                        <div>âœ… Web Audio API ì§€ì›</div>
                        <div>ğŸµ ìƒ˜í”Œë ˆì´íŠ¸: \${audioContext.sampleRate}Hz</div>
                        <div>ğŸ”Š ìƒíƒœ: \${audioContext.state}</div>
                    \`;
                    audioContext.close();
                    audioDiv.parentElement.className = 'test-item success';
                } else {
                    throw new Error('Web Audio API not supported');
                }
            } catch (error) {
                audioDiv.innerHTML = \`<div style="color: #e74c3c;">âŒ ì˜¤ë””ì˜¤ ì‹œìŠ¤í…œ ì˜¤ë¥˜: \${error.message}</div>\`;
                audioDiv.parentElement.className = 'test-item warning';
            }
        }
        
        // ì„±ëŠ¥ ì •ë³´
        function showPerformanceInfo() {
            const perfDiv = document.getElementById('performanceInfo');
            
            const memInfo = performance.memory ? {
                used: Math.round(performance.memory.usedJSHeapSize / 1048576),
                total: Math.round(performance.memory.totalJSHeapSize / 1048576),
                limit: Math.round(performance.memory.jsHeapSizeLimit / 1048576)
            } : null;
            
            let html = \`
                <div>â±ï¸ í˜ì´ì§€ ë¡œë“œ ì‹œê°„: \${Math.round(performance.now())}ms</div>
                <div>ğŸƒ ì‚¬ìš©ì ì—ì´ì „íŠ¸: \${navigator.userAgent.substring(0, 50)}...</div>
                <div>ğŸ§­ ì˜¨ë¼ì¸ ìƒíƒœ: \${navigator.onLine ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}</div>
                <div>ğŸŒ ì–¸ì–´: \${navigator.language}</div>
            \`;
            
            if (memInfo) {
                html += \`
                    <div>ğŸ’¾ ë©”ëª¨ë¦¬ ì‚¬ìš©: \${memInfo.used}MB / \${memInfo.total}MB (í•œê³„: \${memInfo.limit}MB)</div>
                \`;
            }
            
            perfDiv.innerHTML = html;
        }
        
        // ì˜¤ë””ì˜¤ í…ŒìŠ¤íŠ¸
        function testAudio() {
            try {
                const AudioContextClass = window.AudioContext || window.webkitAudioContext;
                const audioContext = new AudioContextClass();
                
                // ê°„ë‹¨í•œ ë¹„í”„ìŒ ìƒì„±
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 440; // A4 ìŒ
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
                
                console.log('ğŸ”Š ì˜¤ë””ì˜¤ í…ŒìŠ¤íŠ¸ ìŒ ì¬ìƒ');
                
                setTimeout(() => {
                    audioContext.close();
                }, 1000);
                
            } catch (error) {
                console.error('ì˜¤ë””ì˜¤ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
            }
        }
        
        // ê²Œì„ ë¡œë“œ
        function loadGame() {
            const frame = document.getElementById('gameFrame');
            frame.style.display = 'block';
            frame.src = 'index.html';
            console.log('ğŸ® ê²Œì„ í”„ë ˆì„ ë¡œë“œ');
        }
        
        // ì¡°ì‘ í…ŒìŠ¤íŠ¸
        function testControls() {
            console.log('ğŸ•¹ï¸ í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            
            const testKeys = ['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Space'];
            let testResults = {};
            
            const keyHandler = (e) => {
                if (testKeys.includes(e.code)) {
                    testResults[e.code] = true;
                    console.log(\`âœ… í‚¤ ê°ì§€: \${e.code}\`);
                    
                    // ëª¨ë“  í‚¤ê°€ í…ŒìŠ¤íŠ¸ë˜ë©´ ë¦¬ìŠ¤ë„ˆ ì œê±°
                    if (Object.keys(testResults).length === testKeys.length) {
                        document.removeEventListener('keydown', keyHandler);
                        console.log('ğŸ¯ ëª¨ë“  í…ŒìŠ¤íŠ¸ í‚¤ ê°ì§€ ì™„ë£Œ!');
                    }
                }
            };
            
            document.addEventListener('keydown', keyHandler);
            
            setTimeout(() => {
                document.removeEventListener('keydown', keyHandler);
                console.log('â° ì¡°ì‘ í…ŒìŠ¤íŠ¸ ì‹œê°„ ì¢…ë£Œ');
            }, 10000);
            
            alert('10ì´ˆ ë™ì•ˆ í™”ì‚´í‘œ í‚¤ì™€ ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”!');
        }
        
        // ì´ˆê¸°í™”
        function init() {
            console.log('ğŸš€ í…ŒíŠ¸ë¦¬ìŠ¤ ê²Œì„ ì‹œìŠ¤í…œ ê²€ì‚¬ ì‹œì‘');
            
            checkSystem();
            checkBrowser();
            checkAudio();
            showPerformanceInfo();
            
            console.log('âœ… ì‹œìŠ¤í…œ ê²€ì‚¬ ì™„ë£Œ');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.addEventListener('load', init);
        
        // ì—ëŸ¬ ìºì¹˜
        window.addEventListener('error', (e) => {
            console.error('ì „ì—­ ì˜¤ë¥˜:', e.error);
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            console.error('ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ê±°ë¶€:', e.reason);
        });
    </script>
</body>
</html>